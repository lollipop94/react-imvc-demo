'use strict';

var _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };

var _reactDom = require('react-dom');

var _reactDom2 = _interopRequireDefault(_reactDom);

var _client = require('create-app/lib/client');

var _client2 = _interopRequireDefault(_client);

var _util = require('../util');

var _util2 = _interopRequireDefault(_util);

var _routes = require('@routes');

var _routes2 = _interopRequireDefault(_routes);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

__webpack_public_path__ = window.__PUBLIC_PATH__ + '/';
var __APP_SETTINGS__ = window.__APP_SETTINGS__ || {};

var getModule = function getModule(module) {
	return module.default || module;
};
var webpackLoader = function webpackLoader(loadModule) {
	if (typeof loadModule === 'function') {
		return new Promise(loadModule).then(getModule);
	}
	return getModule(loadModule);
};

var viewEngine = {
	render: _reactDom2.default.render
};

var routes = _util2.default.getFlatList(Array.isArray(_routes2.default) ? _routes2.default : Object.values(_routes2.default));

var appSettings = _extends({
	hashType: 'hashbang',
	container: '#root'
}, __APP_SETTINGS__, {
	context: _extends({
		preload: {}
	}, __APP_SETTINGS__.context, {
		isClient: true,
		isServer: false
	}),
	loader: webpackLoader,
	routes: routes,
	viewEngine: viewEngine

	/**
  * 动态收集服务端预加载的内容
  */
});var preload = {};
Array.from(document.querySelectorAll('[data-preload]')).forEach(function (elem) {
	var name = elem.getAttribute('data-preload');
	var content = elem.textContent || elem.innerHTML;
	preload[name] = content;
});
appSettings.context.preload = preload;

var app = (0, _client2.default)(appSettings);

app.start();

// 热更新
if (typeof module !== 'undefined' && module.hot) module.hot.accept();